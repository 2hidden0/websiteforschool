<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Customisation</title>
    <link rel="stylesheet" type="text/css" href="/games.css">
    <link rel="stylesheet" type="text/css" href="/effects.css">
    <style>
 body {
            font-family: "M Plus Rounded 1c", sans-serif;
            background-position: center;
            color: white;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            position: relative;
        }

        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            color: var(--primary-color);
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
        }

        label {
            font-weight: bold;
            color: var(--primary-color);
        }

        #export {
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            background-color: var(--secondary-color);
        }

        input[type="text"],
        input[type="color"],
        button[type="submit"],
        button[type="button"] {
            text-shadow: 1px 1px 8px black !important;
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid var(--primary-color);
            box-sizing: border-box;
            background-color: white;
            color: var(--secondary-color);
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch {
            border: none;
        }

        button[type="submit"],
        button[type="button"] {
            text-shadow: 1px 1px 2px black;
            font-size: large;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button[type="submit"]:hover,
        button[type="button"]:hover {
            background-color: darken(var(--primary-color), 10%);
        }

        .selected {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            text-decoration: underline;
        }

        button[type="submit"],
        button[type="button"],
        #default-button {
            display: block;
            margin: 10px auto;
            /* Center the buttons horizontally */
            width: 600px;
            /* Set a fixed width for all buttons */
            text-align: center;
            /* Center text within buttons */
        }
        .image-container {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .image-container img {
            margin: 5px;
            width: 200px;
            height: 200px;
            border: 5px solid white;
            border-radius: 5px;
            object-fit: cover;
            cursor: pointer;
        }

        #default-button {
            display: block;
            margin: 10px auto;
            width: 600px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="navbar-container"></div>
    <div class="navbar-spacer" style="margin-top: 40px;"></div>
    <div class="container" style="margin-bottom: -10px;">
        <p style="font-family: League Gothic; margin-top: -10px; margin-bottom: 0px; font-size: 380%; text-align: center;">
            Customisation
        </p>
        <form id="settings-form">
            <div>
                <label for="background-image">Background Image URL:</label><br>
                <input type="text" id="background-image" name="background-image">
            </div>
            <div>
                <label for="primary-color">Text Colour:</label><br>
                <input type="color" id="primary-color" name="primary-color" value="#000000">
            </div>
            <div>
                <label for="background-color">Secondary Colour:</label><br>
                <input type="color" id="background-color" name="background-color" value="#ffffff">
            </div>
            <div>
                <label for="background-res">Background Resolution (in px):</label><br>
                <input type="text" id="background-res" name="background-res" placeholder="e.g. 1280">
            </div>
            <button type="submit">Save Settings</button>
            <button style="display: none;" type="button" id="default-button">Reset to Defaults</button>
        </form>
    </div>
    <button id="export" style="width: 30vw; margin-top: 4vh;" onclick="downloadCustomisation()">View Theme Data</button>
    <script>
 function downloadCustomisation() {
    const customisationData = localStorage.getItem("customisation");

    const newWindow = window.open("about:blank", "_blank");

    if (newWindow) {
        newWindow.document.write(`<pre>${customisationData}</pre>`);
        newWindow.document.close(); 
    } else {
        console.error("Failed to open a new window.");
    }
}

         </script>

        <p style="text-shadow: 1px 1px 2px black, 1px 1px 4px black, 1px 1px 4px black, 1px 1px 4px black;">Click on an image below to use a premade theme â†“</p>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfe-TUAliierJbhdwvuuRaKCjGCi6oYb_ne8_R06tGtSbwGNQ/viewform?usp=sf_link"><button id="export" style="width: 30vw;">Submit your Theme to be Featured!</button></a>
    <div class="image-container">
        <img src="/background.png" alt="Image 1" data-background="/background.png" data-primary-color="#111E2C" data-secondary-color="#58AAFC" data-background-res="1280">
        <img src="/images/backgrounds/background-old.png" alt="Image 2" data-background="/images/backgrounds/background-old.png" data-primary-color="#111E2C" data-secondary-color="#58AAFC" data-background-res="1280">
        <img src="/images/backgrounds/background-red.png" alt="Image 3" data-background="/images/backgrounds/background-red.png" data-primary-color="#2C1111" data-secondary-color="#FC5858" data-background-res="1280">
        <img src="/images/backgrounds/background-red-old.png" alt="Image 4" data-background="/images/backgrounds/background-red-old.png" data-primary-color="#2C1111" data-secondary-color="#FC5858" data-background-res="1280">
        <img src="/images/backgrounds/background-green.png" alt="Image 5" data-background="/images/backgrounds/background-green.png" data-primary-color="#112C15" data-secondary-color="#5dfc58" data-background-res="1280">
        <img src="/images/backgrounds/background-green-old.png" alt="Image 6" data-background="/images/backgrounds/background-green-old.png" data-primary-color="#112C15" data-secondary-color="#5dfc58" data-background-res="1280">
        <img src="/images/backgrounds/background-purple.png" alt="Image 7" data-background="/images/backgrounds/background-purple.png" data-primary-color="#2C112A" data-secondary-color="#e158fc" data-background-res="1280">
        <img src="/images/backgrounds/background-purple-old.png" alt="Image 8" data-background="/images/backgrounds/background-purple-old.png" data-primary-color="#2C112A" data-secondary-color="#e158fc" data-background-res="1280">
        <img src="/images/backgrounds/white-and-black.png" alt="Image 9" data-background="/images/backgrounds/white-and-black.png" data-primary-color="#232323" data-secondary-color="#FDFDFD" data-background-res="720">
        <img src="/images/backgrounds/topor.png" alt="Image 10" data-background="/images/backgrounds/topor.png" data-primary-color="#DD1766" data-secondary-color="#271117" data-background-res="980">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Rotating_earth_%28large%29.gif/200px-Rotating_earth_%28large%29.gif" alt="Image 11" data-background="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Rotating_earth_%28large%29.gif/200px-Rotating_earth_%28large%29.gif" data-primary-color="#ffffff" data-secondary-color="#000000" data-background-res="1280">
        <img src="https://images4.alphacoders.com/109/thumb-1920-1098025.png" alt="Image 12" data-background="https://images4.alphacoders.com/109/thumb-1920-1098025.png" data-primary-color="#080116" data-secondary-color="#F565C4" data-background-res="1920">

    </div>
    <script src="/main.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
    applyStoredSettings();

    const customisationData = localStorage.getItem('customisation');
    if (customisationData) {
        const [backgroundImage, primaryColor, secondaryColor, backgroundRes] = customisationData.split('\n');

        if (backgroundImage) {
            document.getElementById('background-image').value = backgroundImage;
        }
        if (primaryColor) {
            document.getElementById('primary-color').value = primaryColor;
        }
        if (secondaryColor) {
            document.getElementById('background-color').value = secondaryColor;
        }
        if (backgroundRes) {
            document.getElementById('background-res').value = backgroundRes;
        }
    }
});

document.getElementById('settings-form').addEventListener('submit', function (event) {
    event.preventDefault();
    saveSettingsAndReload();
});

//document.getElementById('default-button').addEventListener('click', function () {
  //  const defaultCustomisation = [
        //'/background.png',
        //'',
      //  '#58AAFC',
    //    '1280'
  //  ].join('\n');

    //localStorage.setItem('customisation', defaultCustomisation);
  //  location.reload();
//});

function applyStoredSettings() {
    const customisationData = localStorage.getItem('customisation');

    if (customisationData) {
        const [backgroundImage, primaryColor, secondaryColor, backgroundRes] = customisationData.split('\n');

        if (backgroundImage) {
            document.body.style.backgroundImage = `url(${backgroundImage})`;
        }
        if (primaryColor) {
            document.documentElement.style.setProperty('--primary-color', primaryColor);
        }
        if (secondaryColor) {
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
        }
        if (backgroundRes) {
            document.body.style.backgroundSize = `${backgroundRes}px ${backgroundRes}px`;
        }
    }
}

function saveSettingsAndReload() {
    const backgroundImageValue = document.getElementById('background-image').value;
    const primaryColorValue = document.getElementById('primary-color').value;
    const secondaryColorValue = document.getElementById('background-color').value;
    const backgroundResValue = document.getElementById('background-res').value;

    // Validate URL
    if (!isValidUrl(backgroundImageValue)) {
        alert('Invalid URL for background image.');
        return;
    }
    // Validate Background Resolution
    if (backgroundResValue && !isValidPixelValue(backgroundResValue)) {
        alert('Background resolution must be a valid pixel value.');
        return;
    }

    const customisationData = [
        backgroundImageValue,
        primaryColorValue,
        secondaryColorValue,
        backgroundResValue
    ].join('\n');

    localStorage.setItem('customisation', customisationData);

    // Reload page after 10ms to ensure settings are saved
    setTimeout(() => location.reload(), 10);
}

function isValidUrl(url) {
    // Allow relative paths that start with a /
    if (url.startsWith('/')) {
        return true;
    }
    try {
        new URL(url);
        return true;
    } catch {
        return false;
    }
}

function isValidPixelValue(value) {
    return /^[0-9]+$/.test(value);
}

document.querySelectorAll('.image-container img').forEach(img => {
    img.addEventListener('click', function () {
        const backgroundUrl = this.getAttribute('data-background');
        const primaryColor = this.getAttribute('data-primary-color');
        const secondaryColor = this.getAttribute('data-secondary-color');
        const backgroundRes = this.getAttribute('data-background-res');

        // Update the form fields
        document.getElementById('background-image').value = backgroundUrl;
        document.getElementById('primary-color').value = primaryColor;
        document.getElementById('background-color').value = secondaryColor;
        document.getElementById('background-res').value = backgroundRes;

        // Save settings and reload
        saveSettingsAndReload();
    });
});

    </script>
</body>

</html>
